/**
 * videojs-chromecast
 * @version 2.0.0
 * @copyright 2016 https://github.com/RavWar/video.js-chromecast
 * @license Apache-2.0
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.videojsChromecast=e()}}(function(){return function e(t,i,o){function r(a,s){if(!i[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(n)return n(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var d=i[a]={exports:{}};t[a][0].call(d.exports,function(e){var i=t[a][1][e];return r(i?i:e)},d,d.exports,e,t,i,o)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,i){(function(e){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),s=function(e,t,i){for(var o=!0;o;){var r=e,n=t,a=i;o=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,n);if(void 0!==s){if("value"in s)return s.value;var c=s.get;if(void 0===c)return;return c.call(a)}var u=Object.getPrototypeOf(r);if(null===u)return;e=u,t=n,i=a,o=!0,s=u=void 0}},c="undefined"!=typeof window?window.videojs:"undefined"!=typeof e?e.videojs:null,u=o(c),d=u["default"].getComponent("Component"),l=u["default"].getComponent("Button"),p=function(e){function t(e,i){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i),this.hide(),e.chromecast=this}return n(t,e),a(t,[{key:"initializeApi",value:function(){var e=void 0,t=void 0,i=void 0;return t=this.options_.appId||chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,i=new chrome.cast.SessionRequest(t),e=new chrome.cast.ApiConfig(i,this.sessionJoinedListener.bind(this),this.receiverListener.bind(this),chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED,chrome.cast.DefaultActionPolicy.CAST_THIS_TAB),chrome.cast.initialize(e,this.onInitSuccess.bind(this),this.castError.bind(this))}},{key:"castError",value:function(e){var t={code:e.code,message:e.description};switch(e.code){case chrome.cast.ErrorCode.API_NOT_INITIALIZED:case chrome.cast.ErrorCode.EXTENSION_MISSING:case chrome.cast.ErrorCode.EXTENSION_NOT_COMPATIBLE:case chrome.cast.ErrorCode.INVALID_PARAMETER:case chrome.cast.ErrorCode.LOAD_MEDIA_FAILED:case chrome.cast.ErrorCode.RECEIVER_UNAVAILABLE:case chrome.cast.ErrorCode.SESSION_ERROR:case chrome.cast.ErrorCode.CHANNEL_ERROR:case chrome.cast.ErrorCode.TIMEOUT:this.addClass("error");break;case chrome.cast.ErrorCode.CANCEL:break;default:this.player_.error(t)}return u["default"].log("Cast Error: "+JSON.stringify(e))}},{key:"onInitSuccess",value:function(){return this.apiInitialized=!0}},{key:"sessionJoinedListener",value:function(e){e.media.length&&(this.apiSession=e,this.onMediaDiscovered(e.media[0]))}},{key:"receiverListener",value:function(e){return"available"===e?this.show():void 0}},{key:"doLaunch",value:function(){return this.apiInitialized?chrome.cast.requestSession(this.onSessionSuccess.bind(this),this.castError.bind(this)):u["default"].log("Session not initialized")}},{key:"onSessionSuccess",value:function(e){var t=void 0,i=void 0,o=void 0,r=void 0,n=void 0,a=void 0;this.apiSession=e;var s=this.player_.cache_.src,c=this.player_.currentType();if(r=new chrome.cast.media.MediaInfo(s,c),r.metadata=new chrome.cast.media.GenericMediaMetadata,this.options_.metadata){n=this.options_.metadata;for(i in n)a=n[i],r.metadata[i]=a}var u=this.player().poster();u&&(t=new chrome.cast.Image(u),r.metadata.images=[t]);var d=this.player().textTracks(),l=[],p=0,h=void 0,f=0,v=void 0;if(d){for(p=0;p<d.length;p++)h=d.tracks_[p],f++,v=new chrome.cast.media.Track(f,chrome.cast.media.TrackType.TEXT),v.trackContentId=h.src.indexOf("//")>=0?h.src:location.origin+h.src,v.trackContentType="text/vtt",v.subtype=chrome.cast.media.TextTrackType.SUBTITLES,v.name=h.label,v.language=h.language,v.customData=null,l.push(v);r.textTrackStyle=new chrome.cast.media.TextTrackStyle,r.textTrackStyle.fontScale=1.15,r.textTrackStyle.fontFamily="Arial",r.textTrackStyle.foregroundColor="#FFCC66FF",r.textTrackStyle.backgroundColor="#000000ะกะก",r.textTrackStyle.edgeType=chrome.cast.media.TextTrackEdgeType.NONE,r.textTrackStyle.windowType=chrome.cast.media.TextTrackWindowType.NONE}l.length&&(r.tracks=l),o=new chrome.cast.media.LoadRequest(r),o.autoplay=!0,o.currentTime=this.player_.currentTime(),this.apiSession.loadMedia(o,this.onMediaDiscovered.bind(this),this.castError.bind(this)),this.apiSession.addUpdateListener(this.onSessionUpdate.bind(this))}},{key:"onMediaDiscovered",value:function(e){this.player_.loadTech_("Chromecast",{type:"cast",apiMedia:e,apiSession:this.apiSession}),this.casting=!0,this.inactivityTimeout=this.player_.options_.inactivityTimeout,this.player_.options_.inactivityTimeout=0,this.player_.userActive(!0),this.addClass("connected"),this.removeClass("error")}},{key:"onSessionUpdate",value:function(e){return this.player_.apiMedia?e?void 0:this.onStopAppSuccess():void 0}},{key:"stopCasting",value:function(){return this.apiSession.stop(this.onStopAppSuccess.bind(this),this.castError.bind(this))}},{key:"onStopAppSuccess",value:function(){this.casting=!1;var e=this.player_.currentTime();return this.removeClass("connected"),this.player_.src(this.player_.options_.sources),this.player_.paused()||this.player_.one("seeked",function(){return this.player_.play()}),this.player_.currentTime(e),this.player_.options_.inactivityTimeout=this.inactivityTimeout,this.apiSession=null}},{key:"buildCSSClass",value:function(){return"vjs-chromecast-button "+s(Object.getPrototypeOf(t.prototype),"buildCSSClass",this).call(this)}},{key:"handleClick",value:function(){return s(Object.getPrototypeOf(t.prototype),"handleClick",this).call(this),this.casting?this.stopCasting():this.doLaunch()}}]),t}(l);p.prototype.inactivityTimeout=2e3,p.prototype.controlText_="Chromecast",d.registerComponent("ChromeCastButton",p),i["default"]=p,t.exports=i["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,i){(function(e){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),s=function(e,t,i){for(var o=!0;o;){var r=e,n=t,a=i;o=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,n);if(void 0!==s){if("value"in s)return s.value;var c=s.get;if(void 0===c)return;return c.call(a)}var u=Object.getPrototypeOf(r);if(null===u)return;e=u,t=n,i=a,o=!0,s=u=void 0}},c="undefined"!=typeof window?window.videojs:"undefined"!=typeof e?e.videojs:null,u=o(c),d=u["default"].getComponent("Component"),l=u["default"].getComponent("Tech"),p=function(e){function t(e,i){var o=this;r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i),this.apiMedia=this.options_.source.apiMedia,this.apiSession=this.options_.source.apiSession,this.receiver=this.apiSession.receiver.friendlyName,this.apiMedia.addUpdateListener(this.onMediaStatusUpdate.bind(this)),this.apiSession.addUpdateListener(this.onSessionUpdate.bind(this));var n=this.textTracks();n&&!function(){var e=o.handleTextTracksChange.bind(o);n.addEventListener("change",e),o.one("ready",e),o.on("dispose",function(){n.removeEventListener("change",e)}),o.handleTextTracksChange()}(),this.update(),this.triggerReady()}return n(t,e),a(t,[{key:"createEl",value:function(){var e=u["default"].createEl("div",{id:this.options_.techId,className:"vjs-tech vjs-tech-chromecast"});return e}},{key:"update",value:function(){this.el_.innerHTML='<div class="casting-image" style="background-image: url(\''+this.options_.poster+'\')"></div><div class="casting-overlay"><div class="casting-information"><div class="casting-icon"></div><div class="casting-description"><small>'+this.localize("CASTING TO")+"</small><br>"+this.receiver+"</div></div></div>"}},{key:"onSessionUpdate",value:function(e){return this.apiMedia?e?void 0:this.onStopAppSuccess():void 0}},{key:"onStopAppSuccess",value:function(){this.stopTrackingCurrentTime(),this.apiMedia=null}},{key:"onMediaStatusUpdate",value:function(){if(this.apiMedia)switch(this.apiMedia.playerState){case chrome.cast.media.PlayerState.BUFFERING:this.trigger("waiting");break;case chrome.cast.media.PlayerState.IDLE:this.trigger("timeupdate");break;case chrome.cast.media.PlayerState.PAUSED:this.trigger("pause"),this.paused_=!0;break;case chrome.cast.media.PlayerState.PLAYING:this.trigger("playing"),this.trigger("play"),this.paused_=!1}}},{key:"src",value:function(e){}},{key:"currentSrc",value:function(){return this.apiMedia?this.apiMedia.media.contentId:void 0}},{key:"handleTextTracksChange",value:function(){var e=[],t=this.textTracks();if(t){for(var i=0;i<t.length;i++){var o=t[i];"showing"===o.mode&&e.push(i+1)}return this.apiMedia&&e.length?(this.tracksInfoRequest=new chrome.cast.media.EditTracksInfoRequest(e),this.apiMedia.editTracksInfo(this.tracksInfoRequest,this.onTrackSuccess.bind(this),this.onTrackError.bind(this))):void 0}}},{key:"onTrackSuccess",value:function(){}},{key:"onTrackError",value:function(e){return u["default"].log("Cast track Error: "+JSON.stringify(e))}},{key:"castError",value:function(e){return u["default"].log("Cast Error: "+JSON.stringify(e))}},{key:"play",value:function(){return this.apiMedia?(this.paused_&&this.apiMedia.play(null,this.mediaCommandSuccessCallback.bind(this,"Playing: "+this.apiMedia.sessionId),this.castError.bind(this)),this.paused_=!1):void 0}},{key:"pause",value:function(){return this.apiMedia?this.paused_?void 0:(this.apiMedia.pause(null,this.mediaCommandSuccessCallback.bind(this,"Paused: "+this.apiMedia.sessionId),this.castError.bind(this)),this.paused_=!0):void 0}},{key:"paused",value:function(){return this.paused_}},{key:"currentTime",value:function(){return this.apiMedia?this.apiMedia.getEstimatedTime():0}},{key:"setCurrentTime",value:function(e){if(!this.apiMedia)return 0;var t=void 0;return t=new chrome.cast.media.SeekRequest,t.currentTime=e,this.apiMedia.seek(t,this.onSeekSuccess.bind(this,e),this.castError.bind(this))}},{key:"onSeekSuccess",value:function(e){}},{key:"volume",value:function(){return this.volume_}},{key:"duration",value:function(){return this.apiMedia?this.apiMedia.media.duration||1/0:0}},{key:"controls",value:function(){return!1}},{key:"setVolume",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],i=void 0,o=void 0;return this.apiMedia?(o=new chrome.cast.Volume,o.level=e,o.muted=t,this.volume_=o.level,this.muted_=t,i=new chrome.cast.media.VolumeRequest,i.volume=o,this.apiMedia.setVolume(i,this.mediaCommandSuccessCallback.bind(this,"Volume changed"),this.castError.bind(this)),this.trigger("volumechange")):void 0}},{key:"mediaCommandSuccessCallback",value:function(e){}},{key:"muted",value:function(){return this.muted_}},{key:"setMuted",value:function(e){return this.setVolume(this.volume_,e)}},{key:"supportsFullScreen",value:function(){return!1}},{key:"resetSrc_",value:function(e){e()}},{key:"dispose",value:function(){this.resetSrc_(Function.prototype),s(Object.getPrototypeOf(t.prototype),"dispose",this).call(this,this)}},{key:"readyState",value:function(){return 4}}]),t}(l);p.prototype.paused_=!1,p.prototype.options_={},p.prototype.timerStep=1e3,p.isSupported=function(){return!0},l.withSourceHandlers(p),p.nativeSourceHandler={},p.nativeSourceHandler.canPlayType=function(e){var t=/^application\/(?:dash\+xml|(x-|vnd\.apple\.)mpegurl)/i,i=/^video\/(mpd|mp4|webm|m3u8)/i;return t.test(e)?"probably":i.test(e)?"maybe":""},p.nativeSourceHandler.canHandleSource=function(e){return e.type?p.nativeSourceHandler.canPlayType(e.type):e.src?p.nativeSourceHandler.canPlayType(e.src):""},p.nativeSourceHandler.handleSource=function(e,t){t.src(e.src)},p.nativeSourceHandler.dispose=function(){},p.registerSourceHandler(p.nativeSourceHandler),p.prototype.featuresVolumeControl=!0,p.prototype.featuresPlaybackRate=!1,p.prototype.movingMediaElementInDOM=!1,p.prototype.featuresFullscreenResize=!1,p.prototype.featuresTimeupdateEvents=!1,p.prototype.featuresProgressEvents=!1,p.prototype.featuresNativeTextTracks=!0,p.prototype.featuresNativeAudioTracks=!0,p.prototype.featuresNativeVideoTracks=!1,u["default"].options.chromecast={},d.registerComponent("Chromecast",p),l.registerTech("Chromecast",p),i["default"]=p,t.exports=i["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,i){(function(t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var o="undefined"!=typeof window?window.videojs:"undefined"!=typeof t?t.videojs:null,r=i(o),n=e("./component/control-bar/chromecast-button"),a=(i(n),e("./tech/chromecast")),s=(i(a),function(e){if("undefined"!=typeof chrome){var t=0,i=this;i.on("loadeddata",function(){var o=i.controlBar.childNameIndex_.chromeCastButton;o||(o=i.controlBar.addChild("chromeCastButton",e),i.controlBar.el().insertBefore(o.el(),i.controlBar.fullscreenToggle.el()));var r=setInterval(function(){chrome.cast&&chrome.cast.isAvailable&&(o.initializeApi(),clearInterval(r)),++t>5&&clearInterval(r)},1e3)})}});r["default"].plugin("chromecast",s)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./component/control-bar/chromecast-button":1,"./tech/chromecast":2}]},{},[3])(3)});